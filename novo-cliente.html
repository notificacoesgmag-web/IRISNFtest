<!DOCTYPE html>

<html lang="pt-br">

<head>

    <meta charset="UTF-8">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>IRIS - Cadastro Inteligente</title>

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;500;700&display=swap" rel="stylesheet">

    <style>

        :root { --bg: #cecece; --card-bg: #ffffff; --accent: #2b2b2b; --text-secondary: #000000; }

        body { font-family: 'Inter', sans-serif; background-color: var(--bg); color: var(--text-secondary); display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; padding: 20px; box-sizing: border-box; }

        .card { background: var(--card-bg); padding: 35px 25px; border-radius: 28px; box-shadow: 0 20px 50px rgba(0, 0, 0, 0.2); text-align: center; width: 100%; max-width: 420px; border: 1px solid #000000; }

        .logo-img { width: 70px; margin-bottom: 15px; }

        h1 { font-weight: 300; letter-spacing: 3px; font-size: 1.1rem; margin-bottom: 25px; color: var(--accent); text-transform: uppercase; }

        .form-section { text-align: left; display: none; }

        .active { display: block; }

        label { font-size: 0.65rem; font-weight: 700; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 5px; display: block; color: #555; }

        input { width: 100%; padding: 12px; background: #ffffff; border: 1px solid #000000; border-radius: 10px; color: #000; font-size: 0.9rem; margin-bottom: 15px; box-sizing: border-box; outline: none; }

        .row { display: flex; gap: 10px; }

        .btn-dark { width: 100%; padding: 16px; background: var(--accent); color: white; border: none; border-radius: 12px; font-weight: 700; font-size: 0.9rem; cursor: pointer; text-transform: uppercase; transition: 0.3s; }

        .btn-dark:disabled { background: #888; }

        .back-link { display: inline-block; margin-top: 20px; color: #666; text-decoration: none; font-size: 0.75rem; }

        #status { font-size: 0.8rem; margin-top: 15px; color: #555; display: none; }

    </style>

</head>

<body>



<div class="card">

    <img src="ChatGPT Image 29 de jan. de 2026, 09_46_46.png" alt="IRIS" class="logo-img">

   

    <div id="passo1" class="form-section active">

        <h1>Consultar CNPJ</h1>

        <label>Informe o CNPJ da Empresa</label>

        <input type="text" id="cnpj" placeholder="00.000.000/0000-00" maxlength="18">

        <button onclick="enviarParaN8N('consultar')" id="btnConsultar" class="btn-dark">Buscar Dados</button>

    </div>



    <div id="passo2" class="form-section">

        <h1>Confirmar Dados</h1>

        <label>Razão Social</label>

        <input type="text" id="razao_social">

        <div class="row">

            <div style="flex: 2;"><label>Logradouro</label><input type="text" id="logradouro"></div>

            <div style="flex: 1;"><label>Nº</label><input type="text" id="numero"></div>

        </div>

        <div class="row">

            <div style="flex: 1;"><label>Bairro</label><input type="text" id="bairro"></div>

            <div style="flex: 1;"><label>CEP</label><input type="text" id="cep"></div>

        </div>

        <div class="row">

            <div style="flex: 2;"><label>Cidade</label><input type="text" id="cidade"></div>

            <div style="flex: 1;"><label>UF</label><input type="text" id="uf"></div>

        </div>

        <label>E-mail de Faturamento</label>

        <input type="email" id="email">

        <button onclick="enviarParaN8N('salvar')" id="btnSalvar" class="btn-dark">Confirmar e Registrar</button>

    </div>

    <div id="status">Processando...</div>

    <a href="index.html" class="back-link">← Cancelar e Voltar</a>

</div>



<script>

// Máscara CNPJ

document.getElementById('cnpj').addEventListener('input', function (e) {

    var x = e.target.value.replace(/\D/g, '').match(/(\d{0,2})(\d{0,3})(\d{0,3})(\d{0,4})(\d{0,2})/);

    e.target.value = !x[2] ? x[1] : x[1] + '.' + x[2] + '.' + x[3] + '/' + x[4] + (x[5] ? '-' + x[5] : '');

});



// FUNÇÃO UNIFICADA: Envia tudo para o mesmo Webhook

async function enviarParaN8N(tipo) {

    const webhookUrl = 'https://vissionlet.com/n8n/webhook-test/novo-cliente';

   

    if (tipo === 'consultar') {

        const cnpj = document.getElementById('cnpj').value.replace(/\D/g, '');

        if(cnpj.length < 14) return alert('CNPJ inválido');

        toggleLoading(true, 'btnConsultar', 'Buscando...');

       

        try {

            const response = await fetch(webhookUrl, {

                method: 'POST',

                headers: { 'Content-Type': 'application/json' },

                body: JSON.stringify({ acao: 'consultar_cnpj', cnpj: cnpj })

            });

            const dados = await response.json();

           

            // Preenche os campos

            document.getElementById('razao_social').value = dados.nome || '';

            document.getElementById('logradouro').value = dados.logradouro || '';

            document.getElementById('numero').value = dados.numero || '';

            document.getElementById('bairro').value = dados.bairro || '';

            document.getElementById('cep').value = dados.cep || '';

            document.getElementById('cidade').value = dados.cidade || '';

            document.getElementById('uf').value = dados.estado || '';

            document.getElementById('email').value = dados.email || '';



            document.getElementById('passo1').classList.remove('active');

            document.getElementById('passo2').classList.add('active');

        } catch (err) { alert('Erro na consulta.'); }

        finally { toggleLoading(false, 'btnConsultar', 'Buscar Dados'); }



    } else if (tipo === 'salvar') {

        toggleLoading(true, 'btnSalvar', 'Registrando...');

        const payload = {

            acao: 'salvar_cliente',

            cnpj: document.getElementById('cnpj').value.replace(/\D/g, ''),

            razao_social: document.getElementById('razao_social').value,

            logradouro: document.getElementById('logradouro').value,

            numero: document.getElementById('numero').value,

            bairro: document.getElementById('bairro').value,

            cep: document.getElementById('cep').value.replace(/\D/g, ''),

            cidade: document.getElementById('cidade').value,

            uf: document.getElementById('uf').value,

            email: document.getElementById('email').value

        };



        try {

            const response = await fetch(webhookUrl, {

                method: 'POST',

                headers: { 'Content-Type': 'application/json' },

                body: JSON.stringify(payload)

            });

            if(response.ok) {

                alert('✅ Sucesso! Cliente no Asaas e na Planilha.');

                window.location.href = 'index.html';

            }

        } catch (err) { alert('Erro ao salvar.'); }

        finally { toggleLoading(false, 'btnSalvar', 'Confirmar e Registrar'); }

    }

}



function toggleLoading(active, btnId, text) {

    const btn = document.getElementById(btnId);

    const status = document.getElementById('status');

    btn.disabled = active;

    btn.innerText = text;

    status.style.display = active ? 'block' : 'none';

}

</script>

</body>

</html>